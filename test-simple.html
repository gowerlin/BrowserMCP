<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrowserMCP ç°¡æ˜“æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4285f4;
            padding-bottom: 10px;
        }
        .test-area {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #3367d6;
        }
        .output {
            margin-top: 20px;
            padding: 15px;
            background: #263238;
            color: #aed581;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .connected {
            background: #d4edda;
            color: #155724;
        }
        .disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        img {
            max-width: 100%;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ BrowserMCP Chrome Extension ç°¡æ˜“æ¸¬è©¦</h1>
        
        <div class="info">
            <strong>æ¸¬è©¦æ­¥é©Ÿï¼š</strong>
            <ol>
                <li>ç¢ºä¿æ“´å……åŠŸèƒ½å·²å®‰è£ä¸¦å•Ÿç”¨</li>
                <li>é»æ“Šæ“´å……åŠŸèƒ½åœ–ç¤ºï¼Œé€£æ¥åˆ°ç•¶å‰æ¨™ç±¤é </li>
                <li>é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…· (F12) çš„ Console</li>
                <li>åœ¨ Console ä¸­åŸ·è¡Œä¸‹æ–¹çš„æ¸¬è©¦å‘½ä»¤</li>
            </ol>
        </div>

        <div class="test-area">
            <h2>ğŸ“¸ æˆªåœ–æ¸¬è©¦</h2>
            <p>åœ¨ Console ä¸­åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ä¾†æ“·å–æˆªåœ–ï¼š</p>
            <div class="output">// åŸºæœ¬æˆªåœ–æ¸¬è©¦
// æ³¨æ„ï¼šé€™éœ€è¦åœ¨ Console ä¸­æ‰‹å‹•åŸ·è¡Œ

// 1. æª¢æŸ¥ browserMCP æ˜¯å¦å¯ç”¨
if (window.browserMCP) {
    console.log('âœ… BrowserMCP helper å·²è¼‰å…¥');
} else {
    console.log('âŒ BrowserMCP helper æœªè¼‰å…¥ï¼Œè«‹ç¢ºèªæ“´å……åŠŸèƒ½å·²é€£æ¥');
}

// 2. æ“·å–æˆªåœ–
if (window.browserMCP) {
    window.browserMCP.sendCommand('Page.captureScreenshot', { 
        format: 'png', 
        quality: 90 
    }).then(result => {
        if (result.success && result.result.data) {
            // å‰µå»ºä¸‹è¼‰é€£çµ
            const a = document.createElement('a');
            a.href = 'data:image/png;base64,' + result.result.data;
            a.download = 'screenshot-' + Date.now() + '.png';
            a.click();
            console.log('âœ… æˆªåœ–å·²å„²å­˜ï¼');
        } else {
            console.error('âŒ æˆªåœ–å¤±æ•—:', result.error);
        }
    });
}</div>
        </div>

        <div class="test-area">
            <h2>ğŸ“Š é é¢è³‡è¨Šæ¸¬è©¦</h2>
            <p>åœ¨ Console ä¸­åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ä¾†å–å¾—é é¢è³‡è¨Šï¼š</p>
            <div class="output">// å–å¾—é é¢è³‡è¨Š
if (window.browserMCP) {
    window.browserMCP.sendCommand('Page.getResourceTree', {})
        .then(result => {
            if (result.success) {
                const info = result.result.frameTree.frame;
                console.log('é é¢è³‡è¨Šï¼š');
                console.log('- URL:', info.url);
                console.log('- å®‰å…¨ä¾†æº:', info.securityOrigin);
                console.log('- MIME é¡å‹:', info.mimeType);
            }
        });
}</div>
        </div>

        <div class="test-area">
            <h2>ğŸ¯ Console æ¸¬è©¦</h2>
            <p>åœ¨ Console ä¸­åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ä¾†å•Ÿç”¨ Console ç›£æ§ï¼š</p>
            <div class="output">// å•Ÿç”¨ Console ç›£æ§
if (window.browserMCP) {
    window.browserMCP.sendCommand('Console.enable', {})
        .then(() => {
            console.log('âœ… Console ç›£æ§å·²å•Ÿç”¨');
            
            // ç”¢ç”Ÿæ¸¬è©¦è¨Šæ¯
            console.log('æ¸¬è©¦è¨Šæ¯ 1');
            console.warn('æ¸¬è©¦è­¦å‘Š');
            console.error('æ¸¬è©¦éŒ¯èª¤');
            console.info('æ¸¬è©¦è³‡è¨Š');
        });
}</div>
        </div>

        <div class="test-area">
            <h2>ğŸ”§ ç›´æ¥æ¸¬è©¦ï¼ˆä¸éœ€è¦ helperï¼‰</h2>
            <p>å¦‚æœ helper æœªè¼‰å…¥ï¼Œå¯ä»¥ç›´æ¥åœ¨ Console ä¸­ä½¿ç”¨ Chrome APIï¼š</p>
            <div class="output">// ç›´æ¥ç™¼é€è¨Šæ¯åˆ°æ“´å……åŠŸèƒ½ï¼ˆéœ€è¦æ“´å……åŠŸèƒ½ IDï¼‰
// è«‹å°‡ EXTENSION_ID æ›¿æ›ç‚ºå¯¦éš›çš„æ“´å……åŠŸèƒ½ ID
chrome.runtime.sendMessage('EXTENSION_ID', {
    action: 'executeDevToolsCommand',
    command: 'Page.captureScreenshot',
    params: { format: 'png', quality: 90 }
}, response => {
    console.log('Response:', response);
});</div>
        </div>

        <div class="test-area">
            <h2>ğŸ’¡ é™¤éŒ¯æç¤º</h2>
            <ul>
                <li>å¦‚æœçœ‹åˆ° "Extension context invalidated" éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼‰å…¥æ“´å……åŠŸèƒ½</li>
                <li>ç¢ºä¿æ“´å……åŠŸèƒ½æœ‰ "å…è¨±å­˜å–æª”æ¡ˆç¶²å€" æ¬Šé™ï¼ˆå¦‚æœä½¿ç”¨ file:// å”è­°ï¼‰</li>
                <li>æª¢æŸ¥æ“´å……åŠŸèƒ½èƒŒæ™¯é é¢çš„ Console ä»¥æŸ¥çœ‹è©³ç´°éŒ¯èª¤</li>
                <li>ä½¿ç”¨ HTTP ä¼ºæœå™¨è€Œä¸æ˜¯ file:// å”è­°å¯ä»¥é¿å…ä¸€äº›æ¬Šé™å•é¡Œ</li>
            </ul>
        </div>
    </div>

    <script>
        // æª¢æŸ¥æ˜¯å¦æœ‰ Chrome extension API
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            console.log('Chrome Extension API å¯ç”¨');
            
            // å˜—è©¦æª¢æ¸¬ BrowserMCP helper
            setTimeout(() => {
                if (window.browserMCP) {
                    console.log('âœ… BrowserMCP helper å·²è‡ªå‹•è¼‰å…¥');
                    console.log('å¯ä»¥ä½¿ç”¨ window.browserMCP.sendCommand() ä¾†åŸ·è¡Œ DevTools å‘½ä»¤');
                } else {
                    console.log('âš ï¸ BrowserMCP helper æœªè‡ªå‹•è¼‰å…¥');
                    console.log('è«‹ç¢ºä¿ï¼š');
                    console.log('1. æ“´å……åŠŸèƒ½å·²å®‰è£ä¸¦å•Ÿç”¨');
                    console.log('2. å·²é€šéæ“´å……åŠŸèƒ½ popup é€£æ¥åˆ°ç•¶å‰æ¨™ç±¤é ');
                    console.log('3. é é¢å·²é‡æ–°æ•´ç†');
                }
            }, 1000);
        } else {
            console.log('âŒ Chrome Extension API ä¸å¯ç”¨');
        }

        // æ·»åŠ ä¸€å€‹ç°¡å–®çš„æ¸¬è©¦å‡½æ•¸
        window.testScreenshot = async function() {
            if (!window.browserMCP) {
                console.error('BrowserMCP helper æœªè¼‰å…¥');
                return;
            }
            
            console.log('é–‹å§‹æ“·å–æˆªåœ–...');
            try {
                const result = await window.browserMCP.sendCommand('Page.captureScreenshot', {
                    format: 'png',
                    quality: 90
                });
                
                if (result.success && result.result.data) {
                    const a = document.createElement('a');
                    a.href = 'data:image/png;base64,' + result.result.data;
                    a.download = 'screenshot-' + Date.now() + '.png';
                    a.click();
                    console.log('âœ… æˆªåœ–å·²å„²å­˜ï¼');
                } else {
                    console.error('æˆªåœ–å¤±æ•—:', result);
                }
            } catch (error) {
                console.error('æˆªåœ–éŒ¯èª¤:', error);
            }
        };

        console.log('æç¤ºï¼šåŸ·è¡Œ testScreenshot() ä¾†å¿«é€Ÿæ¸¬è©¦æˆªåœ–åŠŸèƒ½');
    </script>
</body>
</html>